---
- name: CISCAT-4.1 Configure System Accounting (auditd)
  yum:
    name: "{{ item }}"
    state: present
  with_items:
    - unzip
    - audit
    - audit-libs
  tags:
    - ciscat

- name: Check for GRUB config
  stat:
    path: /boot/grub2/grub.cfg
  register: grb
  tags:
    - ciscat

- name: CISCAT-1.4.1 Ensure permissions on bootloader config are configured
  file:
    path: "{{ item }}"
    owner: root
    group: root
    mode: 0600
  with_items:
    - /boot/grub2/grub.cfg
  when: grb.stat.exists
  tags:
    - ciscat

- name: CISCAT-3.4.2 Ensure /etc/hosts.allow is configured
  copy:
    owner: root
    group: root
    content: |
      # Auto generated by ansible, do not update manually
      ALL: 10.0.0.0/8 172.16.0.0/12 192.168.0.0/16
    dest: /etc/hosts.allow
  tags:
    - ciscat

- name: CISCAT-1.1.17 Ensure noexec option set on /dev/shm partition
  mount:
    path: /dev/shm
    fstype: tmpfs
    src: tmpfs
    opts: size=16g,noexec
    state: present
  tags:
    - ciscat

- name: CISCAT-3.4.3 Ensure /etc/hosts.deny is configured
  copy:
    owner: root
    group: root
    content: |
      # Auto generated by ansible, do not update manually
      ALL: ALL
    dest: /etc/hosts.deny
  tags:
    - ciscat

- name: CISCAT-5.1 Ensure permissions on Cron Files
  file:
    path: "{{ item }}"
    owner: root
    group: root
    mode: 0600
  with_items:
    - /etc/crontab
    - /etc/cron.hourly
    - /etc/cron.daily
    - /etc/cron.weekly
    - /etc/cron.monthly
  ignore_errors: true
  tags:
    - ciscat

- name: CISCAT-5.1.7 Ensure permissions on /etc/cron.d are configured
  file:
    path: "/etc/cron.d"
    mode: 0700
  ignore_errors: true
  tags:
    - ciscat
